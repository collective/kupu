<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      >
  <head>
    <title>Test Editor</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <metal:css define-macro="kupu_styles">
      <link href="kupustyles.css" rel="stylesheet" type="text/css" />
      <link href="kupucustom.css" rel="stylesheet" type="text/css" />
    </metal:css>
   
    <metal:jsmacro define-macro="kupu_jsincludes" tal:omit-tag="">
      <metal:slot define-slot="jsincludes">
        <script type="text/javascript" src="sarissa.js"> </script>
        <script type="text/javascript" src="kupuhelpers.js"> </script>
        <script type="text/javascript" src="kupueditor.js"> </script>
        <script type="text/javascript" src="kupubasetools.js"> </script>
        <script type="text/javascript" src="kupuloggers.js"> </script>
        <script type="text/javascript" src="kupucontentfilters.js"> </script>
        <script type="text/javascript" src="kupuinit.js"> </script>
      </metal:slot>
      <metal:script define-slot="extra_scripts" />
    </metal:jsmacro>
    
    <metal:startjs define-macro="kupu_startjs">
      <metal:slot define-slot="startjs">
        <script type="text/javascript">
            
            var kupu = null;
            var kupuui = null;
            function startKupu() {
                // initialize the editor, initKupu groks 1 arg, a reference to the iframe
                var frame = document.getElementById('kupu-editor'); 
                kupu = initKupu(frame);
                
                // this makes the editor's content_changed attribute set according to changes
                // in a textarea or input (registering onchange, see saveOnPart() for more
                // details)
                kupu.registerContentChanger(document.getElementById('kupu-editor-textarea'));

                // get a reference to the ui for the buttons
                kupuui = kupu.getTool('ui'); 

                // let's register saveOnPart(), to ask the user if he wants to save when 
                // leaving after editing
                if (kupu.getBrowserName() == 'IE') {
                    // IE supports onbeforeunload, so let's use that
                    addEventHandler(window, 'beforeunload', saveOnPart);
                } else {
                    // some versions of Mozilla support onbeforeunload (starting with 1.7)
                    // so let's try to register and if it fails fall back on onunload
                    var re = /rv:([0-9\.]+)/
                    var match = re.exec(navigator.userAgent)
                    if (match[1] && parseFloat(match[1]) > 1.6) {
                        addEventHandler(window, 'beforeunload', saveOnPart);
                    } else {
                        addEventHandler(window, 'unload', saveOnPart);
                    };
                };

                // and now we can initialize...
                kupu.initialize();
            };
            
        </script>
      </metal:slot>
    </metal:startjs>

    <metal:saveonpart define-macro="kupu_saveonpart">
      <metal:slot define-slot="saveonpart">
        <script type="text/javascript">

            function saveOnPart() {
              /* ask the user if (s)he wants to save the document before leaving */
              if (kupu.content_changed && 
                  confirm('You have unsaved changes. Do you want to save before leaving the page?')) {
                kupu.config.reload_src = 0;
                kupu.saveDocument(false, true);
              };
            };
        
        </script>
      </metal:slot>
    </metal:saveonpart>

    <metal:sourceedit define-macro="kupu_sourceedit">
      <metal:slot define-slot="sourceedit">
        <script type="text/javascript">

          function switchSourceEdit() {
            var editorframe = document.getElementById('kupu-editor');
            var sourcearea = document.getElementById('kupu-editor-textarea');
            var kupudoc = kupu.getInnerDocument();

            if (editorframe.style.display != 'none') {
              if (kupu.getBrowserName() == 'Mozilla') {
                kupudoc.designMode = 'Off';
              };
              kupu._initialized = false;
              var data = kupu.getInnerDocument().documentElement.getElementsByTagName('body')[0].innerHTML;
              sourcearea.value = data;
              editorframe.style.display = 'none';
              sourcearea.style.display = 'block';
            } else {
              var data = sourcearea.value;
              kupu.getInnerDocument().documentElement.getElementsByTagName('body')[0].innerHTML = data;
              sourcearea.style.display = 'none';
              editorframe.style.display = 'block';
              if (kupu.getBrowserName() == 'Mozilla') {
                kupudoc.designMode = 'On';
              };
              kupu._initialized = true;
            };
          };
        
        </script>
      </metal:slot>
    </metal:sourceedit>
    
  </head>
  <body onload="startKupu()">
    <div style="visibility: hidden">
      <!-- the configuration -->
      <xml id="kupuconfig">
        <kupuconfig>
          <dst>fulldoc.html</dst>
          <use_css>1</use_css>
          <reload_after_save>0</reload_after_save>
          <strict_output>1</strict_output>
          <content_type>application/xhtml+xml</content_type>
          <compatible_singletons>1</compatible_singletons>
        </kupuconfig>
      </xml>
    </div>
  
    <h1>Kupu Editor Test Page</h1>

    <div class="kupu-fulleditor">
      <div metal:define-macro="kupu_fulleditor">

        <!-- Start toolbar -->
        <metal:toolbar metal:define-slot="kupu_toolbar_slot">
        <div class="kupu-tb" id="toolbar" metal:define-macro="kupu_toolbar">
          <span id="kupu-tb-buttons">
            <metal:slot define-slot="buttongroup_logo">
              <span class="kupu-tb-buttongroup" style="float: right">
                <button type="button" class="kupu-logo" title="Kupu 1.1"
                        i18n:attributes="title" accesskey="k"
                        onclick="window.open('http://kupu.oscom.org');">&nbsp;</button>
              </span>
            </metal:slot>
            <metal:slot define-slot="tb_select_styles">
              <select id="kupu-tb-styles" onchange="kupuui.setTextStyle(this.options[this.selectedIndex].value);">
                <option value="P" i18n:translate="paragraph-normal">
                  Normal
                </option>
                <option value="H1">
                  <span tal:omit-tag="" i18n:translate="heading">Heading</span> 1
                </option>
                <option value="H2">
                  <span tal:omit-tag="" i18n:translate="heading">Heading</span> 2
                </option>
                <option value="H3">
                  <span tal:omit-tag="" i18n:translate="heading">Heading</span> 3
                </option>
                <option value="H4">
                  <span tal:omit-tag="" i18n:translate="heading">Heading</span> 4
                </option>
                <option value="H5">
                  <span tal:omit-tag="" i18n:translate="heading">Heading</span> 5
                </option>
                <option value="H6">
                  <span tal:omit-tag="" i18n:translate="heading">Heading</span> 6
                </option>
                <option value="PRE" i18n:translate="paragraph-formatted">
                  Formatted
                </option>
              </select>
            </metal:slot>
            <metal:slot define-slot="buttongroup_save">
              <span class="kupu-tb-buttongroup">
                <button type="button" class="kupu-save" id="kupu-save-button" title="Save"
                        i18n:attributes="title" accesskey="s">&nbsp;</button>
              </span>
            </metal:slot>
            <metal:slot define-slot="buttongroup_basicmarkup">
              <span class="kupu-tb-buttongroup">
                <button type="button" class="kupu-bold" id="kupu-bold-button" title="Bold"
                        i18n:attributes="title" accesskey="b">&nbsp;</button>
                <button type="button" class="kupu-italic" id="kupu-italic-button" title="Italic"
                        i18n:attributes="title" accesskey="i">&nbsp;</button>
                <button type="button" class="kupu-underline" id="kupu-underline-button" title="Underline"
                        i18n:attributes="title" accesskey="u">&nbsp;</button>
              </span>
            </metal:slot>
            <metal:slot define-slot="buttongroup_subsuper">
              <span class="kupu-tb-buttongroup">
                <button type="button" class="kupu-subscript" id="kupu-subscript-button" title="Subscript"
                        i18n:attributes="title" accesskey="v">&nbsp;</button>
                <button type="button" class="kupu-superscript" id="kupu-superscript-button" title="Superscript"
                        i18n:attributes="title" accesskey="^">&nbsp;</button>
              </span>
            </metal:slot>
            <metal:slot define-slot="buttongroup_color">
              <span class="kupu-tb-buttongroup">
                <!-- Note: the event handlers are attached to these buttons dynamically, like for tools -->
                <button type="button" class="kupu-forecolor" id="kupu-forecolor-button" title="Text Color"
                        i18n:attributes="title" accesskey="f">&nbsp;</button>
                <button type="button" class="kupu-hilitecolor" id="kupu-hilitecolor-button" title="Background Color"
                        i18n:attributes="title" accesskey="h">&nbsp;</button>
              </span>
            </metal:slot>
            <metal:slot define-slot="buttongroup_justify">
              <span class="kupu-tb-buttongroup">
                <button type="button" class="kupu-justifyleft" id="kupu-justifyleft-button" title="Left Justify"
                        i18n:attributes="title" accesskey="l">&nbsp;</button>
                <button type="button" class="kupu-justifycenter" id="kupu-justifycenter-button" title="Center"
                        i18n:attributes="title" accesskey="c">&nbsp;</button>
                <button type="button" class="kupu-justifyright" id="kupu-justifyright-button" title="Right Justify"
                        i18n:attributes="title" accesskey="r">&nbsp;</button>
              </span>
            </metal:slot>
            <metal:slot define-slot="buttongroup_list">
              <span class="kupu-tb-buttongroup">
                <!-- list button events are set on the list tool -->
                <button type="button" class="kupu-insertorderedlist" id="kupu-list-ol-addbutton" title="Numbered List"
                        i18n:attributes="title" accesskey="1">&nbsp;</button>
                <button type="button" class="kupu-insertunorderedlist" id="kupu-list-ul-addbutton" title="Unordered List"
                        i18n:attributes="title" accesskey="-">&nbsp;</button>
              </span>
            </metal:slot>
            <metal:slot define-slot="buttongroup_indent">
              <span class="kupu-tb-buttongroup">
                <button type="button" class="kupu-outdent" id="kupu-outdent-button" title="Outdent"
                        i18n:attributes="title" accesskey="<">&nbsp;</button>
                <button type="button" class="kupu-indent" id="kupu-indent-button" title="Indent"
                        i18n:attributes="title" accesskey=">">&nbsp;</button>
              </span>
            </metal:slot>
            <metal:slot define-slot="buttongroup_undo">
              <span class="kupu-tb-buttongroup">
                <button type="button" class="kupu-undo" id="kupu-undo-button" title="Undo"
                        i18n:attributes="title" accesskey="z">&nbsp;</button>
                <button type="button" class="kupu-redo" id="kupu-redo-button" title="Redo"
                        i18n:attributes="title" accesskey="y">&nbsp;</button>
              </span>
            </metal:slot>
            <metal:slot define-slot="buttongroup_source">
              <span class="kupu-tb-buttongroup">
                <button type="button" class="kupu-source" id="kupu-source-button" title="Edit source"
                        i18n:attributes="title" accesskey="@"
                        onclick="switchSourceEdit()">&nbsp;</button>
              </span>
            </metal:slot>
            <metal:buttons define-slot="extra_buttons" />
          </span>
          <metal:slot define-slot="tb_select_listitem">
            <select id="kupu-ulstyles">
              <option value="disc" i18n:translate="list-disc">&#9679;</option>
              <option value="square" i18n:translate="list-square">&#9632;</option>
              <option value="circle" i18n:translate="list-circle">&#9675;</option>
              <option value="none" i18n:translate="list-nobullet">no bullet</option>
            </select>
            <select id="kupu-olstyles">
              <option value="decimal" 
                      i18n:translate="list-decimal">1</option>
              <option value="upper-roman" 
                      i18n:translate="list-upperroman">I</option>
              <option value="lower-roman" 
                      i18n:translate="list-lowerroman">i</option>
              <option value="upper-alpha" 
                      i18n:translate="list-upperalpha">A</option>
              <option value="lower-alpha" 
                      i18n:translate="list-loweralpha">a</option>
            </select>
          </metal:slot>

          <metal:toolbar define-slot="extra_toolbar" />
        </div>
        </metal:toolbar>
        
      <!-- end toolbar -->

        <metal:toolboxes define-slot="kupu_toolboxes_slot">
        <div class="kupu-toolboxes" metal:define-macro="kupu_toolboxes">

          <div class="kupu-toolbox" id="kupu-toolbox-properties" metal:define-slot="kupu_toolbox_properties">
            <!-- start kupu toolbox properties -->
            <h1>Properties</h1>

            <table id="kupu-properties">
              <tbody>
                <tr>
                  <td class="kupu-toolbox-label">Title</td>
                  <td><input id="kupu-properties-title" />
                  </td>
                </tr>
                <tr>
                  <td colspan="2" class="kupu-toolbox-label">Description</td>
                </tr>
                <tr>
                  <td colspan="2">
                    <textarea id="kupu-properties-description"></textarea>
                  </td>
                </tr>
              </tbody>
            </table>
            
            <!-- end kupu toolbox properties -->
          </div>

          <div class="kupu-toolbox" id="kupu-toolbox-links" metal:define-slot="kupu_toolbox_links">
            <!-- start kupu toolbox links -->
            <h1 i18n:translate="links">Links</h1>

            <div id="kupu-toolbox-addlink">
              <div class="kupu-toolbox-label">
                <!--           Link to items matching the keyword  -->
                <span tal:omit-tag="" i18n:translate="items-matching-keyword">
                  Link the highlighted text to this URL
                </span>:
              </div>

              <input id="kupu-link-input"
                     class="kupu-toolbox-st" 
                     type="text" size="14" />
              <div style="text-align: center">
                <button type="button" id="kupu-link-button"
                        class="kupu-toolbox-action">Make Link</button>
              </div>

            </div>

            <!-- end kupu toolbox links -->
          </div>

          <div class="kupu-toolbox" id="kupu-toolbox-images" metal:define-slot="kupu_toolbox_images">
            <!-- start kupu toolbox images -->
            <h1 i18n:translate="images">Images</h1>

            <div class="kupu-toolbox-label">
              <span tal:omit-tag="" i18n:translate="">
                Insert image at the following URL
              </span>:
            </div>

            <input id="kupu-image-input"
                   value="kupuimages/kupu_icon.gif"
                   class="kupu-toolbox-st" 
                   type="text" size="14" />
            <div style="text-align: center">
              <button type="button" id="kupu-image-addbutton" class="kupu-toolbox-action">Insert Image</button>
            </div>

            <!-- end kupu toolbox images -->
          </div>

          <div class="kupu-toolbox" id="kupu-toolbox-tables" metal:define-slot="kupu_toolbox_tables">
            <!-- start kupu toolbox tables -->
            
            <h1 i18n:translate="table-inspector">Tables</h1>
            <table width="100%">
              <tbody>
                <tr>
                  <td class="kupu-toolbox-label">Table Class</td>
                  <td>
                    <select id="kupu-table-classchooser">
                      <option value="plain">Plain</option>
                      <option value="listing">Listing</option>
                      <option value="grid">Grid</option>
                      <option value="data">Data</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td colspan="2">
                    <div id="kupu-toolbox-addtable">
                      <table width="100%">
                        <tr>
                          <td class="kupu-toolbox-label">Rows</td>
                          <td><input id="kupu-table-newrows"/></td>
                        </tr>
                        <tr>
                          <td class="kupu-toolbox-label">Columns</td>
                          <td><input id="kupu-table-newcols"/></td>
                        </tr>
                        <tr>
                          <td class="kupu-toolbox-label">Headings</td>
                          <td class="kupu-toolbox-label">
                            <input id="kupu-table-makeheader" type="checkbox"/> Create
                          </td>
                        </tr>
                        <tr>
                          <td colspan="2" style="text-align: center">
                            <button type="button" id="kupu-table-addtable-button">Add Table</button>
                          </td>
                        </tr>
                      </table>
                    </div>
                    <div id="kupu-toolbox-edittable">
                      <table width="100%">
                        <tr>
                          <td>Col Align</td>
                          <td>
                            <select id="kupu-table-alignchooser">
                              <option value="left">Left</option>
                              <option value="center">Center</option>
                              <option value="right">Right</option>
                              </select>
                          </td>
                        </tr>
                        <tr>
                          <td>Column</td>
                          <td>
                              <button type="button" id="kupu-table-addcolumn-button">Add</button>
                              <button type="button" id="kupu-table-delcolumn-button">Remove</button>
                          </td>
                        </tr>
                        <tr>
                          <td>Row</td>
                          <td>
                            <button type="button" id="kupu-table-addrow-button">Add</button> 
                            <button type="button" id="kupu-table-delrow-button">Remove</button></td>
                        </tr>
                      </table>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>

            <!-- end kupu toolbox tables -->
          </div>
          <div class="kupu-toolbox" id="kupu-toolbox-extra">
            <!-- start kupu toolbox extra -->

            <metal:toolbox define-slot="extra_toolbox" />

            <!-- end kupu toolbox extra -->
          </div>

          <div class="kupu-toolbox" id="kupu-toolbox-debug" metal:define-slot="kupu_toolbox_debug">
            <!-- start kupu toolbox debug -->
            <h1 i18n:translate="debug-log">Debug Log</h1>

            <div id="kupu-toolbox-debuglog" class="kupu-toolbox-label" style="height: 150px;">
            </div>

            <!-- end kupu toolbox debug -->
          </div>

        </div>
        </metal:toolboxes>

        <!-- End toolboxes  -->

        <table id="kupu-colorchooser" cellpadding="0" cellspacing="0" style="position: fixed; border-style: solid; border-color: black; border-width: 1px;" metal:define-macro="kupu_colorchoosertable"></table>
              
        <div class="kupu-editorframe" metal:define-slot="kupu_editorframe">
          <form>
            <iframe id="kupu-editor" 
                    frameborder="0" 
                    src="fulldoc.html"
                    metal:define-macro="kupu_editorframe"
                    scrolling="auto"
                    ></iframe>
            <textarea id="kupu-editor-textarea" style="display: none"> </textarea>
          </form>

        </div>
      </div>

    </div>
  </body>
</html>
